```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Import libraries

```{r}
library(readr)
library(tidyverse)
library(ggplot2)
library(broom)
library(stats)
```

### Read the data

```{r}
data <- read_csv("cost-of-living.csv")
```

### Structure of the data

```{r}
head(data)
```

### Plotting data

```{r}
plotting <- function(salary, param) {
  hist(salary, col="darkred", border="white")
  hist(param, col="darkred", border="white")
}
```

### Mean value

```{r}
means <- function(param) {
  return(mean(param))
}
```

### Data Grouping

```{r}
group_by <- function(data, n) {
  x <- map_dbl(data, 1)
  y <- map_dbl(data, 2)
  sorted_x <- sort(x)
  sorted_y <- y[order(x)]
  data <- map2(sorted_x, sorted_y, ~ c(.x, .y))
  count <- 0
  grouped_list <- list()
  salary_sum <- 0
  gasonile_sum <- 0
  for(tuple in data) {
    count <- count + 1
    salary_sum <- salary_sum + tuple[[1]]
    gasonile_sum <- gasonile_sum + tuple[[2]]
    if (count == n) {
      grouped_list[[length(grouped_list) + 1]] <- list(salary_sum / n, gasonile_sum / n)
      count <- 0
      salary_sum <- 0
      gasonile_sum <- 0
    }
  }
  grouped_list[[length(grouped_list) + 1]] <- list(salary_sum / count, gasonile_sum / count)
  return(grouped_list)
}
```

### Plotting linear model

```{r}
lm_plotting <- function(lm) {
  plot(x, y, pch=16, col="blue")
  abline(lm, col = "red")
}
```

#### Firstly we want to check how gasoline price depends on salary

```{r}
new_data <- data[! is.na(data$x54) & ! is.na(data$x33), ]
merge_list <- map2(new_data$x54, new_data$x33, ~ c(.x, .y))
grouped_list <- group_by(merge_list, 100)

x <- map_dbl(grouped_list, 1)
y <- map_dbl(grouped_list, 2)
plotting(x, y)
linear_model <- lm(y ~ x)
lm_plotting(linear_model)
```

#### We can see that we have some nezrozumile sho, Fedya opishi

#### Let's try to check other dependencies(salary \~ Apartment in City centre and salary \~ primary school)

```{r}
new_data <- data[! is.na(data$x54) & ! is.na(data$x50), ]
merge_list <- map2(new_data$x54, new_data$x50, ~ c(.x, .y))
grouped_list <- group_by(merge_list, 100)

x <- map_dbl(grouped_list, 1)
y <- map_dbl(grouped_list, 2)
plotting(x, y)
linear_model1 <- lm(y ~ x)
lm_plotting(linear_model1)
```

```{r}
new_data <- data[! is.na(data$x54) & ! is.na(data$x43), ]
merge_list <- map2(new_data$x54, new_data$x43, ~ c(.x, .y))
grouped_list <- group_by(merge_list, 100)

x <- map_dbl(grouped_list, 1)
y <- map_dbl(grouped_list, 2)
plotting(x, y)
linear_model2 <- lm(y ~ x)
lm_plotting(linear_model2)
```

### We see two linear models with high goodness-of-fit

let's compare their slopes param.

```{r}
slope1 <- coef(linear_model1)[2]
slope2 <- coef(linear_model2)[2]
print(slope1)
print(slope2)
```

#### What we see

### Table

```{r}
mtr <- matrix(0, nrow = 53, ncol = 2)
count <- 1
data <- data[! is.na(data$x54), ]
for(col in colnames(data)) {
  if (col != "x54" & col != "data_quality" & col != "city" & col != "country" & col != "...1" & col != "x42") {
    mtr[count, 1] <- col
    new_data <- data[ ! is.na(data[[col]]), ]
    merge_list <- map2(new_data$x54, new_data[[col]], ~ c(.x, .y))
    grouped_list <- group_by(merge_list, 100)
    x <- map_dbl(grouped_list, 1)
    y <- map_dbl(grouped_list, 2)
    linear_model <- lm(y ~ x)
    model_summary <- summary(linear_model)
    r_squared <- model_summary$r.squared
    if (r_squared > .75) {
      mtr[count, 2] <- round(means(x) / means(y) * coef(linear_model)[2], 2)
    }
    count <- count + 1
  }
}
for (i in 1:dim(mtr)[1]) {
    for (j in 1:dim(mtr)[2]) {
        cat(mtr[i, j], " ")
    }
    cat("\n")
}
```
